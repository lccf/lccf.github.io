---
title: win平台编译64位gvim
date: 2013-07-16 18:51
tags:
- 编译vim
- 编译译64位vim
- vim添加微软雅黑字体支持
categories: Vim
---

接上篇：我编译的gvim7.4a BETA 64位版本(win平台)

1.安装visualstudio 2012，hg

2.获取源代码
hg clone https://vim.googlecode.com/hg/ vim
hg update v7-4a

3.源代码修改
启用非等宽字体支持，修改该项后可使用微软雅黑字体。
编辑 vim/src/os_mswin.c 查找

```c
/* Ignore non-monospace fonts without further ado */
    if ((ntm->tmPitchAndFamily & 1) != 0)
    return 1;
```

注释即该段代码即可。

关微软雅黑字体：
vim显示非等宽字体是有bug的所以关掉了。汉字都是方块字全部等宽的，在开启非等宽字体支持后我们可以用微软雅黑显示汉字。在vimrc中添加如下配置：
`set gfw=youyuan:h10.5:cGB2312`

4.编译
打开vs命令提示行

![](/img/201307/vs_shoot.png)

切换到源码目录
编译命令：

```bash
nmake -f Make_mvc.mak PYTHON=C:\Python27 DYNAMIC_PYTHON=yes PYTHON_VER=27 MBYTE=yes USERNAME=leftcold USERDOMAIN=gmail.com GUI=yes
```

说明：将USERNAME USERDOMAIN修改为你的邮箱名、邮箱域，可以定制vim中编译人信息。将GUI选项修改为no可以编译命令行版本。PYTHON为自己的python安装路径，将PYTHON选项去掉，编译的将是不带python支持的版本。

参考链接：https://groups.google.com/forum/#!topic/vim_dev/N8jzif4e9L8
http://nootn.com/blog/Tool/22/
https://github.com/asins/vim